# Enhanced A Record Generator for Mail Infrastructure

A sophisticated bash script for generating DNS A records with advanced pattern obfuscation, cross-run uniqueness tracking, and 15 diverse naming styles to prevent mail server enumeration.

## Features

### Security Enhancements
- **Non-Sequential IP Assignment**: IPs are shuffled before name assignment
- **Pattern Breaking**: 15 unique naming styles with internal randomization
- **Cross-Run Uniqueness**: Persistent state tracking prevents duplicate names
- **Enhanced Obfuscation**: Multiple layers of randomization within each style

### Naming Styles
1. **Quantum Hash** - Multiple hash algorithms with random segments
2. **Phonetic Soup** - Random pronounceable syllables
3. **UUID Fragment** - Partial UUIDs with random positioning
4. **Chemical Compound** - Element symbols + random numbers
5. **Matrix Code** - Alphanumeric matrices
6. **Weather Pattern** - Meteorological terms + codes
7. **Crypto Ticker** - Cryptocurrency-style naming
8. **Bio Sequence** - DNA/protein-like sequences
9. **Radio Callsign** - Aviation/maritime style identifiers
10. **Mesh Node** - Distributed system naming
11. **Mythic Cipher** - Mythology + encryption style
12. **Color Storm** - Colors + weather phenomena
13. **Time Warp** - Time-based with distortion
14. **Element Fusion** - Chemical elements fusion
15. **Constellation Code** - Star patterns

## Installation

1. Clone or download the script package
2. Ensure required dependencies are installed:
   ```bash
   # Required commands
   sudo yum install -y jq openssl coreutils
   ```

3. Make the main script executable:
   ```bash
   chmod +x generate-enhanced.sh
   ```

## Directory Structure

```
generate-enhanced/
â”œâ”€â”€ generate-enhanced.sh          # Main script
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ state_manager.sh         # Cross-run uniqueness tracking
â”‚   â”œâ”€â”€ name_generators.sh       # 15 naming style implementations
â”‚   â”œâ”€â”€ entropy_pools.sh         # 600+ tokens for randomization
â”‚   â””â”€â”€ utils.sh                 # Helper functions
â”œâ”€â”€ state/
â”‚   â””â”€â”€ used_names.json          # Persistent name tracking
â””â”€â”€ cidrs.txt                    # Input file with CIDR blocks
```

## Usage

### Basic Usage
```bash
./generate-enhanced.sh cidrs.txt > output.zone
```

### Input File Format
The `cidrs.txt` file should contain CIDR blocks with their associated domains:
```
# For /24 blocks - exactly 8 domains required
192.0.2.0/24,mail1.example.com,mail2.example.com,mx1.example.net,mx2.example.net,smtp1.example.org,smtp2.example.org,relay1.example.co,relay2.example.co

# For /27 blocks - exactly 1 domain required
203.0.113.0/27,priority.fastmail.io
```

### Output Format
The script generates standard BIND zone file format:
```
;; Block 192.0.2.0/24 (domains: mail1.example.com mail2.example.com ...)
;; Using randomized IP assignment and mixed naming styles
qh873a5f.mail1.example.com.               IN A 192.0.2.147
nexu-142.mail2.example.com.               IN A 192.0.2.23
h2o5-7fc.mx1.example.net.                 IN A 192.0.2.89
storm95kt.mx2.example.net.                IN A 192.0.2.201
```

## Advanced Features

### State Management
- Names are tracked in `state/used_names.json`
- Prevents duplicates across multiple runs
- Automatic backup on corruption
- State statistics available

### Preflight Checks
The script performs comprehensive checks before execution:
- Required command availability
- Directory structure creation
- State file initialization
- Library file verification

### Performance
- Optimized for processing up to 50 /24 networks
- Efficient name collision detection
- Minimal memory footprint

## Examples

### Generate Records for Multiple Blocks
```bash
# Create input file with multiple networks
cat > cidrs.txt <<EOF
10.0.1.0/24,m1.corp.com,m2.corp.com,m3.corp.com,m4.corp.com,m5.corp.com,m6.corp.com,m7.corp.com,m8.corp.com
10.0.2.0/24,s1.corp.com,s2.corp.com,s3.corp.com,s4.corp.com,s5.corp.com,s6.corp.com,s7.corp.com,s8.corp.com
EOF

# Generate records
./generate-enhanced.sh cidrs.txt > corp-mail.zone
```

### View State Statistics
```bash
# Check how many names have been generated
jq '.total_generated' state/used_names.json

# View last run timestamp
jq '.last_run' state/used_names.json
```

### Export State for Analysis
```bash
# The state file is already in JSON format
cat state/used_names.json | jq '.used_names | keys' | head -20
```

## Naming Examples

Here are examples of names generated by each style:

- **Quantum Hash**: `qh873a5f`, `qm42b7c9d1`, `qc8f2e4`
- **Phonetic Soup**: `velura82`, `krano-4f`, `zephix3a`
- **UUID Fragment**: `u-4f8a-2c3d`, `7b2_9f_3e4a`, `dx-8f3c2a`
- **Chemical Compound**: `h2o5-7fc`, `nacl3-42`, `fe2cu-x9`
- **Matrix Code**: `mx8g42k71`, `t5x794f`, `arr342bf`
- **Weather Pattern**: `storm95kt`, `nimbus-23c`, `gale42`
- **Crypto Ticker**: `BTC42`, `eth-sol`, `XR2f4`
- **Bio Sequence**: `acgt-742`, `rwty83`, `atp9xy`
- **Radio Callsign**: `alfa27`, `N42XY`, `KB835`
- **Mesh Node**: `node-8f3c4a`, `c2a-n451`, `mesh142-89`

## Troubleshooting

### State File Corruption
```bash
# The script auto-detects corruption and creates backups
# To manually recover:
mv state/used_names.json state/used_names.json.corrupt
cp state/used_names.json.backup.* state/used_names.json
```

### Missing Dependencies
```bash
# Check which commands are missing
for cmd in jq openssl xxd; do
    command -v $cmd >/dev/null || echo "Missing: $cmd"
done
```

### Performance Issues
- For very large deployments (>50 /24 blocks), consider splitting input files
- State file grows over time; periodic cleanup may be needed
- Use SSD storage for state directory for better performance

## Security Considerations

1. **Enumeration Protection**: The randomized, non-sequential assignment makes it computationally expensive to enumerate mail servers
2. **Pattern Analysis**: With 15 diverse styles mixing randomly, pattern analysis becomes extremely difficult
3. **State File**: Keep `state/used_names.json` secure as it contains your naming history
4. **Entropy Sources**: The script uses multiple entropy sources including `/dev/urandom`, time-based seeds, and IP-derived entropy

## License

This script is provided as-is for mail infrastructure management. Modify and distribute as needed for your organization.

## Contributing

To add new naming styles:
1. Add a new function in `lib/name_generators.sh`
2. Follow the pattern: `generate_[style_name]() { ... }`
3. Ensure names are DNS-compliant using `sanitize_dns_label`
4. Add the style number to the dispatcher in `generate_name()`
